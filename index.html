<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure AI Text Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Simple loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex justify-center items-start">

    <div class="w-full max-w-2xl bg-white p-6 md:p-8 rounded-xl shadow-2xl space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 border-b pb-4">Secure Gemini Proxy</h1>
        <p class="text-sm text-gray-500">
            This application uses a Vercel Serverless Function (`/api/generate`) to safely call the Gemini API, protecting your `GEMINI_API_KEY` from public exposure.
        </p>

        <textarea id="promptInput" rows="4" 
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
            placeholder="Enter your prompt here (e.g., Write a short poem about coding a perfect function)..."></textarea>

        <button id="generateBtn" 
            class="w-full flex justify-center items-center px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
            Generate Content
            <div id="loadingSpinner" class="spinner ml-3"></div>
        </button>

        <div id="responseContainer" class="mt-6 p-4 bg-indigo-50 border border-indigo-200 rounded-lg shadow-inner">
            <h2 class="text-xl font-semibold text-indigo-800 mb-2">AI Response</h2>
            <p id="responseText" class="whitespace-pre-wrap text-gray-700">The generated text will appear here.</p>
        </div>
    </div>

    <script>
        const promptInput = document.getElementById('promptInput');
        const generateBtn = document.getElementById('generateBtn');
        const responseText = document.getElementById('responseText');
        const loadingSpinner = document.getElementById('loadingSpinner');

        generateBtn.addEventListener('click', async () => {
            const userPrompt = promptInput.value.trim();
            if (!userPrompt) {
                responseText.textContent = "Please enter a prompt.";
                return;
            }

            // UI updates for loading state
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            loadingSpinner.style.display = 'block';
            responseText.textContent = 'Awaiting response from serverless function...';

            try {
                // Post request to the Vercel Serverless Function proxy
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // Send the user's prompt as JSON data
                    body: JSON.stringify({ prompt: userPrompt }),
                });

                if (!response.ok) {
                    throw new Error(`Serverless Function Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    responseText.textContent = `API Error: ${data.error}`;
                } else {
                    // Display the content received from the proxy
                    responseText.textContent = data.text || "No text generated.";
                }

            } catch (error) {
                console.error("Fetch failed:", error);
                responseText.textContent = `Failed to connect to the generator. Check the console for errors. Details: ${error.message}`;
            } finally {
                // UI updates for ending state
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Content';
                loadingSpinner.style.display = 'none';
            }
        });
    </script>
</body>
</html>
